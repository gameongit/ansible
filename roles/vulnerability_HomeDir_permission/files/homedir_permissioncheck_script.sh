#!/bin/sh

echo "HomeDir , OverallPermission , User, OtherPermission" > /tmp/homedir_permissioncheck.txt

for i in $(ls /home | grep -v lost)
do
PER=$(stat /home/$i | grep "Uid" | awk '{print $2}' | cut -d'(' -f2 |cut -d'/' -f1)
OtherPER=$(stat /home/$i | grep "Uid" | awk '{print $2}' | cut -d'(' -f2 |cut -d'/' -f1 | cut -c4-)
USR=$(stat /home/$i | grep "Uid" | cut -d'/' -f3 | cut -d')' -f1 | tr -d '[:space:]')
USRCHK=$(echo $USR | grep "^[0-9]*$")
if [[ $PER > 0750 ]] || [[ $USR == "root" ]] || [[ $USR == "UNKNOWN" ]] || [[ ! -z "$USRCHK" ]] || [[ $OtherPER -gt 0 ]]; then
echo "/home/$i ,   $PER   ,   $USR  ,   $OtherPER  " | tee -a /tmp/homedir_permissioncheck.txt
fi
done
